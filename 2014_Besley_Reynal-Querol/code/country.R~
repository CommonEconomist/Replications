#==============================================================================
# 15 January 2014
# Last update: 15 January 2014
# R-script for creating dependent variables country cross-section
#==============================================================================
# To Do
# Calculate rates of conflict years relative to years since independence
# Calculate variables for different type of conflict
#==============================================================================

# Load data for countries
setwd("/home/swl/Dropbox/Sandbox/baba/data/")
load("countrycode_data.rda")

# Extract African countries
ccode<-countrycode_data[countrycode_data$continent=="Africa",]
ccode<-ccode[complete.cases(ccode[,"country.name"]),]
ccode<-ccode[,c(1:3,7:9,13:14)]

# Load data to determine data of independence
polity<-read.csv("p4v2012.csv",sep=",",header=TRUE,row.names=NULL)
polity<-polity[,c(2,4,5,33)]
colnames(polity)<-c("cown","country","year","change")

# Subset data to create sample
df<-merge(polity,ccode)
df$ind<-as.numeric(df$change==99)
df[df==0]<-NA
df<-na.omit(df) # Should result in 51 countries

# Correct names
df$country<-as.character(df$country)
df[df$cown==484,]$country<-"Congo" # Republic of the Congo
df[df$cown==490,]$country<-"Democratic Republic of the Congo" 

rm(polity,ccode)

# Load data on conflict
# NB-This list is hand-made from UCDP/PRIO data
acd<-read.csv("acd2013.csv",header=TRUE,sep=",",row.names=NULL)
acd<-acd[acd$region==4 | acd$country=="Egypt",] # Subset to African countries
acd<-acd[,c(1,2,4,5:7)]

# Code different type of intensity
acd$minor<-as.numeric(acd$int==1) # between 25-999 battle-related deaths
acd$war<-as.numeric(acd$int==2) # >=1000 battle-related deaths

# Code for different type of war
acd$imp<-as.numeric(acd$type==1) # Colonial war
acd$inter<-as.numeric(acd$type==2) # Interstate war
acd$intra<-as.numeric(acd$type==3 | acd$type==4) # Intrastate conflict

# Add country codes
require(countrycode)
acd$cown<-countrycode(acd$country,"country.name","cown",warn=TRUE) # Ignore warnings

# Merge data
ind<-df[,c(1:3)]
colnames(ind)<-c("cown","country","indyear")
acd<-merge(ind,acd,all.x=TRUE) # France is dropped, 51 countries in total
acd[is.na(acd)]<-0 # Recode NA to zero

# Years covered in period of interest 
acd$p1<-2007-acd$indyear
acd$p2<-2010-acd$indyear

# Calculate number of wars for each period including pre-independence
acd$pre_ind<-as.numeric(acd$year<acd$indyear) # Pre-independence conflict
acd$p1w<-as.numeric(acd$year>=acd$indyear & acd$year<=2007)
acd$p2w<-as.numeric(acd$year>=acd$indyear & acd$year<=2010)

acd<-within(acd,{pre_sum=ave(pre_ind,cown,FUN=sum)}) # Pre-independence
acd<-within(acd,{p1_sum=ave(p1w,cown,FUN=sum)}) # Independence - 2007
acd<-within(acd,{p2_sum=ave(p2w,cown,FUN=sum)}) # Independence - 2010

# Leave summations for specific type of conflict for later

# Aggregate the data
acd.df<-aggregate(.~cown+country,acd,FUN=max) # Should result in 51 countries
acd.df<-acd.df[order(acd.df$country),]
acd.df<-acd.df[,c(1:3,9:21)]

# Save data
dir.create("~/Dropbox/Sandbox/baba/output/")
setwd("~/Dropbox/Sandbox/baba/output/")
save(list="acd.df",file="ACD.Rdata")

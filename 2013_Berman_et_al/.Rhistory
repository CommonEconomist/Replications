0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+a.adjust,y+.05,r,cex=1,col="white")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,4,0,5,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,6,0,7,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,10,0,10,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,10,0,12,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,10,0,14,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,0,10,0,15,
0,0,0,0,0,
0,0,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.2),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
max(y)
text(60,1.2,"1m",col="white",cex=1.2)
segments(60,0,60,1,lwd=2,col="white",lty=2)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.4),xlim=c(0,570),lwd=5,col="yellow")
text(x+x.adjust,y+.05,r,cex=1,col="white")
## Indicators
text(60,1.2,"1m",col="white",cex=1.2)
segments(60,0,60,1.15,lwd=2,col="white",lty=2)
text(120,1.2,"2m",col="white",cex=1.2)
segments(120,0,120,1.15,lwd=2,col="white",lty=2)
text(300,1.2,"5m",col="white",cex=1.2)
segments(300,0,300,1.15,lwd=2,col="white",lty=2)
text(480,1.2,"8m",col="white",cex=1.2)
segments(480,0,480,1.15,lwd=2,col="white",lty=2)
text(600,1.2,"10m",col="white",cex=1.2)
segments(600,0,600,1.15,lwd=2,col="white",lty=2)
r
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,620),lwd=5,col="yellow")
text(60,1.2,"1m",col="white",cex=1.2)
text(60,1.3,"1m",col="white",cex=1.2)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,620),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(600,1.4,"10m",col="white",cex=1.2)
segments(600,0,600,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
r
y<-1.1-norm(y)
x.adjust<-c(-6,0,-7,0,0,
0,5,10,0,15,
0,0,0,0,0,
0,3,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,620),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(600,1.4,"10m",col="white",cex=1.2)
segments(600,0,600,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
d<-read.csv("~/Downloads/tourploeg/gc.csv",header=TRUE)
d<-d[d[,3]<=600,]
x<-d[,3]
y<-d[,2]
r<-as.character(d[,1])
norm<-function(x){
(x-min(x))/(max(x)-min(x))
}
y<-1.1-norm(y)
x.adjust<-c(-6,0,-7,0,0,
0,5,10,0,15,
0,0,0,0,0,
0,3,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,620),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(600,1.4,"10m",col="white",cex=1.2)
segments(600,0,600,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(-10,610),lwd=5,col="yellow")
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(600,1.4,"10m",col="white",cex=1.2)
segments(600,0,600,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,580),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
r
x.adjust<-c(-6,0,-7,0,0,
0,5,10,0,15,
0,0,0,0,5,
0,5,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,580),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
x.adjust<-c(-6,0,-7,0,0,
0,5,10,0,15,
0,0,0,0,5,
0,6,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,580),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
17/2
r
x
r
y
.7-0.6333333
x[2]+0.0666667
y[2]+0.0666667
max(d[,2])
abline(h=.5,lty=3,lwd=2,col="white")
#### Plotting general classification results from Tour de France after stage 9####
## Load time vector
d<-read.csv("~/Downloads/tourploeg/gc.csv",header=TRUE)
d<-d[d[,3]<=600,]
x<-d[,3]
y<-d[,2]
r<-as.character(d[,1])
norm<-function(x){
(x-min(x))/(max(x)-min(x))
}
y<-1.1-norm(y)
x.adjust<-c(-6,0,-7,0,0,
0,5,10,0,15,
0,0,0,0,5,
0,6,0)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,580),lwd=5,col="yellow")
## Indicators
text(60,1.4,"1m",col="white",cex=1.2)
segments(60,0,60,1.35,lwd=2,col="white",lty=2)
text(120,1.4,"2m",col="white",cex=1.2)
segments(120,0,120,1.35,lwd=2,col="white",lty=2)
text(300,1.4,"5m",col="white",cex=1.2)
segments(300,0,300,1.35,lwd=2,col="white",lty=2)
text(480,1.4,"8m",col="white",cex=1.2)
segments(480,0,480,1.35,lwd=2,col="white",lty=2)
text(x+x.adjust,y+.05,r,cex=1,col="white")
d<-read.csv("~/Downloads/tourploeg/gc.csv",header=TRUE)
d<-d[d[,3]<=600,]
y<-d[,3]
x<-d[,2]
r<-as.character(d[,1])
norm<-function(x){
(x-min(x))/(max(x)-min(x))
}
x<-1.1-norm(x)
par(mar=c(4,4,6,4),bg="black")
plot(x,y,type="h",bty="n",ylim=c(-.1,1.5),xlim=c(0,580),lwd=5,col="yellow")
plot(x,y)
dev.off()
plot(x,y)
plot(x,y,type="h")
barplot(x,y)
barplot(y,x)
load("~/Dropbox/Sandbox/epidemais/output/bootstrap_output.RData")
bts2<-subset(bts,bts$cert.lvl!=3)
dat2<-aggregate(cbind(exp0,exp1,norm.pre.c,norm.dum.c,col.c)
~hh+cluster+gov,bts2,FUN=sum)
dat2<-dat2[order(dat2$cluster),]
hist(exp0.nc.r,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$exp1),col="red",lwd=2)
abline(v=sum(dat2$exp0),col="red",lwd=2)
bts2<-subset(bts,bts$cert.lvl!=3 & bts$cert.lvl!=4)
dat2<-aggregate(cbind(exp0,exp1,norm.pre,norm.dum,col,col.c,norm.pre.c,norm.dum.c)
~hh+cluster+gov,bts2,FUN=sum)
dat2<-dat2[order(dat2$cluster),]
hist(exp0.c,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$exp0),col="red",lwd=2)
hist(exp1.c,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$exp1),col="red",lwd=2)
abline(v=mean(exp1.c),col="red",lwd=2)
hist(d0,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$norm.pre)),col="red",lwd=2)
abline(v=sum(dat2$norm.pre),col="red",lwd=2)
hist(d1,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$norm.dum),col="red",lwd=2)
abline(v=sum(dat2$col),col="red",lwd=2)
hist(d2,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$col),col="red",lwd=2)
hist(exp0.cf,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$exp0),col="red",lwd=2)
hist(exp1.cf,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$exp1),col="red",lwd=2)
hist(cf0,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$norm.pre.c),col="red",lwd=2)
abline(v=sum(dat2$norm.dum.c),col="red",lwd=2)
hist(cf1,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$norm.dum.c),col="red",lwd=2)
hist(cf2,prob=TRUE, col="grey",main="")
abline(v=sum(dat2$col.c),col="red",lwd=2)
tdf<- read.table(url("http://www.theusrus.de/Blog-files/TDF2015.txt"),
header=T, sep="\t", quote="")
View(tdf)
x<-tdf$S1
par(mar=c(4,4,8,4),bg="black")
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
x<-sort(tdf$S1)
par(mar=c(4,4,8,4),bg="black")
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
text(x[5],1.1,"+15s",cex=1.2,col="white");segments(x[5],1.01,x[5],1.08,lwd=2,col="white")
text(x[8],1.1,"+29s",cex=1.2,col="white");segments(x[8],1.01,x[8],1.08,lwd=2,col="white")
text(x[99],1.1,"+1m19s",cex=1.2,col="white");segments(x[99],1.01,x[99],1.08,lwd=2,col="white")
text(x[197],1.1,"+2m28s",cex=1.2,col="white");segments(x[197],1.01,x[197],1.08,lwd=2,col="white")
text(x[198],1.1,"+3m36s",cex=1.2,col="white");segments(x[198],1.01,x[198],1.08,lwd=2,col="white")
tdf<- read.table(url("http://www.theusrus.de/Blog-files/TDF2015.txt"),
header=T, sep="\t", quote="")
names(tdf)
par(mar=c(4,4,8,4),bg="black")
plot(tdf$S1,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
x<-tdf$S1
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
x<-sort(tdf$S1)
par(mar=c(4,4,8,4),bg="black")
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
text(x[5],1.1,"+15s",cex=1.2,col="white");segments(x[5],1.01,x[5],1.08,lwd=2,col="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
text(x[5],1.1,"+15s",cex=1.2,col="white");segments(x[5],1.01,x[5],1.08,lwd=2,col="white")
text(x[8],1.1,"+29s",cex=1.2,col="white");segments(x[8],1.01,x[8],1.08,lwd=2,col="white")
text(x[99],1.1,"+1m19s",cex=1.2,col="white");segments(x[99],1.01,x[99],1.08,lwd=2,col="white")
text(x[197],1.1,"+2m28s",cex=1.2,col="white");segments(x[197],1.01,x[197],1.08,lwd=2,col="white")
text(x[198],1.1,"+3m36s",cex=1.2,col="white");segments(x[198],1.01,x[198],1.08,lwd=2,col="white")
x<-sort(tdf$S1)
par(mar=c(4,4,8,4),bg="black")
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
text(x[5],1.1,"+15s",cex=1.2,col="white");segments(x[5],1.01,x[5],1.08,lwd=2,col="white")
text(x[8],1.1,"+29s",cex=1.2,col="white");segments(x[8],1.01,x[8],1.08,lwd=2,col="white")
text(x[99],1.1,"+1m19s",cex=1.2,col="white");segments(x[99],1.01,x[99],1.08,lwd=2,col="white")
text(x[197],1.1,"+2m28s",cex=1.2,col="white");segments(x[197],1.01,x[197],1.08,lwd=2,col="white")
text(x[198],1.1,"+3m36s",cex=1.2,col="white");segments(x[198],1.01,x[198],1.08,lwd=2,col="white")
par(mar=c(4,2,8,2),bg="black")
plot(x,rep(1,198),type="h",axes=FALSE,xlab="",ylab="",lwd=5,col="yellow",
main="Stage 1 (13.8 Km) \n Utrecht / Utrecht",cex.main=2, col.main="white")
text(x[1],1.1,"14m56s",cex=1.2,col="white");segments(x[1],1.01,x[1],1.08,lwd=2,col="white")
text(x[5],1.1,"+15s",cex=1.2,col="white");segments(x[5],1.01,x[5],1.08,lwd=2,col="white")
text(x[8],1.1,"+29s",cex=1.2,col="white");segments(x[8],1.01,x[8],1.08,lwd=2,col="white")
text(x[99],1.1,"+1m19s",cex=1.2,col="white");segments(x[99],1.01,x[99],1.08,lwd=2,col="white")
text(x[197],1.1,"+2m28s",cex=1.2,col="white");segments(x[197],1.01,x[197],1.08,lwd=2,col="white")
text(x[198],1.1,"+3m36s",cex=1.2,col="white");segments(x[198],1.01,x[198],1.08,lwd=2,col="white")
names(tdf)
length(20:31)
gc<-tdf[,24:35] # Note this changes everyday
colnames(gc)<-1:12
start<-1; last<-12
med<-as.vector(sapply(gc,median,na.rm=TRUE))
gc.m<-sweep(gc,2,med,"-")
Lines <- function(series, col="black", hcol="black", lwd=1, hlwd=2) {
for (i in 1:length(series[,1])) {
lines(start:last, series[i,], col=col, lwd=lwd)
}
par(las=1, tck=0.02, mgp=c(2.8,0.3,0.5), cex.lab=1.2,cex.main=2,col.main="white",
cex.axis=1.2,bg="black")
plot(0,xlim=c(start,last),ylim=c(-5310,3960),
type="n",bty="n",main="General classification after stage 12",xlab="",ylab="",axes=FALSE)
Lines(gc.m,col="white")
axis(1,las=1,at=1:12,tck=0.02,cex.axis=1.5,col="white",col.axis="white")
lines(start:last,gc.m[28,],col="yellow",lwd=4)     # Froome
lines(start:last,gc.m[19,],col="firebrick3",lwd=4) # Pinot
lines(start:last,gc.m[124,],col="orange",lwd=4)    # Ten Dam
plot(0,xlim=c(start,last),ylim=c(-5310,3960),
type="n",bty="n",main="General classification after stage 12",xlab="",ylab="",axes=FALSE)
Lines(gc.m,col="white")
axis(1,las=1,at=1:12,tck=0.02,cex.axis=1.5,col="white",col.axis="white")
names(tdf)
stage<-tdf[,8:23] # Note this changes everyday
colnames(stage)<-1:16
start<-1; last<-16
med<-as.vector(sapply(stage,median,na.rm=TRUE))
stage.m<-sweep(stage,2,med,"-")
par(las=1, tck=0.02, mgp=c(2.8,0.3,0.5), cex.lab=1.2,cex.main=2,col.main="white",
cex.axis=1.2,bg="black")
summary(stage.m)
max(stage.m,na.rm=TRUE)
min(stage.m,na.rm=TRUE)
plot(0,xlim=c(start,last),ylim=c(-2020,1450),
type="n",bty="n",main="Stage results",xlab="",ylab="",axes=FALSE)
Lines(stage.m,col="white")
axis(1,las=1,at=1:16,tck=0.02,cex.axis=1.5,col="white",col.axis="white")
View(tdf)
lines(start:last,stage.m[28,],col="yellow",lwd=4)     # Froome
lines(start:last,gc.m[43,],col="green",lwd=4)         # Sagan
lines(start:last,stage.m[43,],col="green",lwd=4)      # Sagan
lines(start:last,gc.m[118,],col="orange",lwd=4)       # Gesink
lines(start:last,stage.m[118,],col="orange",lwd=4)       # Gesink
setwd("~/Dropbox/Sandbox/epidemais2")
library(maptools)
library(foreign)
library(spdep)
library(plyr)
library(RColorBrewer)
library(DataCombine)
districts<-readShapeSpatial("raw_data/iraq_districts.shp")  # District borders
berman<-read.dta("raw_data/BermanetalAER2013replication.dta")
districts<-districts[order(districts$ADM3NAME),]
k<-poly2nb(districts,queen=TRUE) # Neighbour list, queen contiguity
W<-nb2listw(k,style="B",zero.policy=TRUE) # Spatial weights (binary)
adj<-as.matrix(listw2mat(W)) # Adjacency matrix
row.names(adj)<-districts$ADM3NAME
T<-length(as.vector(unique(berman$halfyr)))
ident<-diag(1,nrow=T)
berman<-berman[order(berman$halfyr,berman$district),]
adj<-adj[order(row.names(adj)),]
length(intersect(berman$district,row.names(adj)))
berman$w.p_S1<-as.numeric((ident%x%adj)%*%berman$p_S1)
berman[is.na(berman$a_of_batt),]$a_of_batt<-0
berman$w.a_of_batt<-as.numeric((ident%x%adj)%*%berman$a_of_batt)
berman$w.p_ms_cerp_small<-as.numeric((ident%x%adj)%*%berman$p_ms_cerp_small)
berman$w.dis_usprt<-as.numeric((ident%x%adj)%*%berman$dis_usprt)
ds<-ddply(berman,.(district),summarize,
mean.p_S1=mean(p_S1),
mean.p_ms_cerp=mean(p_ms_cerp),
a_of_batt=max(a_of_batt),
sum.prt=sum(dis_usprt))
View(ds)
districts@data<-data.frame(districts@data,
p_attacks=ds$mean.p_S1,
p_aid=ds$mean.p_ms_cerp,
batt_dis=ds$a_of_batt,
prt_dist=ds$sum.prt)
par(mfrow = c(1, 2),
oma = c(4, 0, 0, 0),
mar = c(0, 0, 2.5, 2),
mgp = c(0, 0, 0),
xpd = NA)
brks<-c(0.1,0.25,.5,1,1.5,2,3,5,9)
col.regions=brewer.pal(9,"Greys")
plot(districts,
col=col.regions[findInterval(districts$p_attacks,brks,all.inside=TRUE)],
axes=F,cex.main=2,lwd=.5,
main="Number of attacks per capita")
legend(39,31, legend=leglabs(brks), fill=col.regions, bty="n",cex=1.2,
y.intersp=.5)
## Average aid per capita
brks<-c(0,2.5,5,10,15,30,40,50,200)
col.regions=brewer.pal(9,"Greys")
plot(districts,
col=col.regions[findInterval(districts$p_aid,brks,all.inside=TRUE)],
axes=F,cex.main=2,lwd=.5,
main="Aid dollars per capita")
legend(39,31, legend=leglabs(brks), fill=col.regions, bty="n",cex=1.2,
y.intersp=.5)
moran.mc(ds$mean.p_S1,listw=W,nsim=9999)
moran.mc(ds$mean.p_ms_cerp,listw=W,nsim=9999)
par(mar=c(5,4,4,4))
moran.plot(ds$mean.p_S1,listw=W,
pch=16, col="black",cex=1.5,
quiet=F,labels=as.character(ds$district),
xlab="",ylab="",bty="n",axes=FALSE)
axis(1,at=seq(0,10,1),tck=0.02,cex.axis=1.2)
axis(1,at=seq(0,10,0.5),labels=F,tck=0.01)
axis(2,at=seq(0,55,5),las=1,tck=0.02,cex.axis=1.2)
axis(2,at=seq(0,55,1),labels=F,tck=0.01)
mtext("Conflict intensity (log)",side=1,cex=1.2,line=3)
mtext("Spatial lag conflict intensity",side=2,cex=1.2,line=2.5)
dev.off()
par(mar=c(5,4,4,4))
dev.off()
par(mar=c(5,4,4,4))
moran.plot(ds$mean.p_S1,listw=W,
pch=16, col="black",cex=1.5,
quiet=F,labels=as.character(ds$district),
xlab="",ylab="",bty="n",axes=FALSE)
axis(1,at=seq(0,10,1),tck=0.02,cex.axis=1.2)
axis(1,at=seq(0,10,0.5),labels=F,tck=0.01)
axis(2,at=seq(0,55,5),las=1,tck=0.02,cex.axis=1.2)
axis(2,at=seq(0,55,1),labels=F,tck=0.01)
mtext("Conflict intensity (log)",side=1,cex=1.2,line=3)
mtext("Spatial lag conflict intensity",side=2,cex=1.2,line=2.5)
lm<-localmoran(ds$mean.p_S1,listw=W)
districts$lm<-abs(lm[,4]) ## Extract z-scores
brks<-c(0,.5,1,1.5,2,3,4,9)
col.regions=brewer.pal(8,"Greys")
par(mar = c(2, 0, 2.5, 2))
plot(districts,
col=col.regions[findInterval(districts$lm,brks,all.inside=TRUE)],
axes=F,cex.main=2,lwd=.5,
main="Local Moran Z-score")
legend(38,32, legend=leglabs(brks), fill=col.regions, bty="n",cex=1.2,
y.intersp=.5)
par(mar=c(5,4,4,4))
moran.plot(ds$mean.p_ms_cerp,listw=W,
pch=16, col="black",cex=1.5,
quiet=F,labels=as.character(ds$district),
xlab="",ylab="",bty="n",,axes=FALSE)
axis(1,at=seq(0,300,50),tck=0.02,cex.axis=1.2)
axis(1,at=seq(0,300,10),labels=F,tck=0.01)
axis(2,at=seq(0,400,50),las=1,tck=0.02,cex.axis=1.2)
axis(2,at=seq(0,400,10),labels=F,tck=0.01)
mtext("Aid",side=1,cex=1.2,line=3)
mtext("Spatial lag aid",side=2,cex=1.2,line=2.5)
lm<-localmoran(ds$mean.p_ms_cerp,listw=W)
districts$lm<-abs(lm[,4]) ## Extract z-scores
brks<-c(0,.5,1,1.5,2,3,5,6,7)
col.regions=brewer.pal(9,"Greys")
par(mar = c(2, 0, 2.5, 2))
plot(districts,
col=col.regions[findInterval(districts$lm,brks,all.inside=TRUE)],
axes=F,cex.main=2,lwd=.5,
main="Local Moran Z-score")
legend(37,33, legend=leglabs(brks), fill=col.regions, bty="n",cex=1.2,
y.intersp=.5)
setwd("~/Dropbox/Glasnost/Replications/2013_Berman_et_al")
library(maptools)
library(foreign)
library(spdep)
library(plyr)
library(RColorBrewer)
library(DataCombine)
districts<-readShapeSpatial("raw_data/iraq_districts.shp")  # District borders
districts<-readShapeSpatial("iraq_districts.shp")  # District borders
berman<-read.dta("BermanetalAER2013replication.dta")
districts<-districts[order(districts$ADM3NAME),]
plot(districts)
